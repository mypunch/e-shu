<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E-Surat App â€” Netlify Version</title>
  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for in-browser JSX transform -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // LocalStorage helpers
    const loadData = (key, fallback) => {
      try {
        const data = JSON.parse(localStorage.getItem(key));
        return data || fallback;
      } catch {
        return fallback;
      }
    };
    const saveData = (key, data) => {
      localStorage.setItem(key, JSON.stringify(data));
    };

    // Reusable UI
    const Label = ({ children }) => (
      <label className="block text-sm font-medium text-gray-700 mb-1">{children}</label>
    );
    const Input = (props) => (
      <input {...props} className={"w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 " + (props.className||"")} />
    );
    const Textarea = (props) => (
      <textarea {...props} className={"w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 " + (props.className||"")} />
    );
    const Button = ({ variant = "primary", className = "", ...props }) => {
      const base = "inline-flex items-center justify-center gap-2 rounded-md px-4 py-2 text-sm font-semibold shadow-sm transition";
      const styles = {
        primary: "bg-indigo-600 text-white hover:bg-indigo-700",
        subtle: "bg-gray-100 text-gray-900 hover:bg-gray-200",
        danger: "bg-red-600 text-white hover:bg-red-700"
      };
      return <button className={base + " " + (styles[variant]||styles.primary) + " " + className} {...props} />;
    };

    function App() {
      const [seq, setSeq] = useState(1);
      const [activePage, setActivePage] = useState("Registrasi Naskah");

      const [listNaskah, setListNaskah] = useState(() => loadData("naskah", []));
      const [listTujuan, setListTujuan] = useState(() => loadData("tujuan", []));
      const [listVerifikator, setListVerifikator] = useState(() => loadData("verifikator", []));
      const [listPenandatangan, setListPenandatangan] = useState(() => loadData("penandatangan", []));

      // persist changes
      useEffect(() => saveData("naskah", listNaskah), [listNaskah]);
      useEffect(() => saveData("tujuan", listTujuan), [listTujuan]);
      useEffect(() => saveData("verifikator", listVerifikator), [listVerifikator]);
      useEffect(() => saveData("penandatangan", listPenandatangan), [listPenandatangan]);

      const nomorAuto = useMemo(() => {
        const now = new Date();
        const y = now.getFullYear();
        const pad = String(seq).padStart(4, "0");
        return \`ND/\${pad}/UNIT/\${y}\`;
      }, [seq]);

      const submitRegistrasi = (e) => {
        e.preventDefault();
        const form = new FormData(e.target);
        const hal = (form.get("hal") || "").toString().trim();
        if (!hal) {
          alert("Field 'Hal' wajib diisi.");
          return;
        }
        const newNaskah = {
          id: Date.now(),
          nomorNaskah: nomorAuto,
          hal,
          jenisNaskah: form.get("jenisNaskah") || "",
          sifatNaskah: form.get("sifatNaskah") || "",
          klasifikasi: form.get("klasifikasi") || "",
          isiRingkas: form.get("isiRingkas") || "",
          tanggal: new Date().toLocaleDateString(),
        };
        setListNaskah(prev => [...prev, newNaskah]);
        setSeq(prev => prev + 1);
        e.target.reset();
        alert("Naskah tersimpan.");
      };

      const addData = (setter, keyFields) => (e) => {
        e.preventDefault();
        const form = new FormData(e.target);
        const entry = { id: Date.now() };
        for (let f of keyFields) {
          const val = (form.get(f) || "").toString().trim();
          if (!val) { alert(f + " wajib diisi"); return; }
          entry[f] = val;
        }
        setter(prev => [...prev, entry]);
        e.target.reset();
      };

      const removeItem = (listSetter, id) => {
        listSetter(prev => prev.filter(x => x.id !== id));
      };

      return (
        <div className="min-h-screen">
          {/* Topbar */}
          <header className="sticky top-0 bg-white border-b border-gray-200 z-10">
            <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
              <span className="font-semibold">SRIKANDI</span>
              <span className="text-gray-400">/</span>
              <span className="text-gray-500">{activePage}</span>
              <div className="ml-auto text-sm text-gray-500">E-Surat App (Netlify)</div>
            </div>
          </header>

          <div className="max-w-7xl mx-auto px-4 py-6 grid grid-cols-12 gap-6">
            {/* Sidebar */}
            <aside className="col-span-12 md:col-span-3 lg:col-span-2">
              <div className="bg-white rounded-md border p-3">
                <div className="text-xs font-semibold text-gray-500 mb-2">NAVIGASI</div>
                <nav className="space-y-1 text-sm">
                  {[
                    "Registrasi Naskah",
                    "Daftar Naskah Keluar",
                    "Tujuan Naskah",
                    "Verifikator",
                    "Penanda Tangan",
                  ].map((item) => (
                    <button
                      key={item}
                      onClick={() => setActivePage(item)}
                      className={
                        "w-full text-left block px-3 py-2 rounded " +
                        (activePage === item
                          ? "bg-indigo-50 text-indigo-700"
                          : "text-gray-700 hover:bg-gray-50")
                      }
                    >
                      {item}
                    </button>
                  ))}
                </nav>
              </div>
            </aside>

            {/* Main Content */}
            <main className="col-span-12 md:col-span-9 lg:col-span-10 space-y-6">
              {activePage === "Registrasi Naskah" && (
                <div className="bg-white rounded-md shadow p-4">
                  <h1 className="text-xl font-bold mb-6">Registrasi Naskah</h1>
                  <form onSubmit={submitRegistrasi} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="md:col-span-2">
                      <Label>Nomor Naskah (otomatis)</Label>
                      <Input value={nomorAuto} disabled />
                    </div>
                    <div className="md:col-span-2">
                      <Label>Hal *</Label>
                      <Input name="hal" placeholder="Perihal surat" required />
                    </div>
                    <div><Label>Jenis Naskah</Label><Input name="jenisNaskah" /></div>
                    <div><Label>Sifat Naskah</Label><Input name="sifatNaskah" /></div>
                    <div><Label>Klasifikasi</Label><Input name="klasifikasi" /></div>
                    <div className="md:col-span-2"><Label>Isi Ringkas</Label><Textarea name="isiRingkas" rows="3" /></div>
                    <div className="md:col-span-2 flex gap-3">
                      <Button type="submit">Simpan</Button>
                      <Button type="reset" variant="subtle">Reset</Button>
                    </div>
                  </form>
                </div>
              )}

              {activePage === "Daftar Naskah Keluar" && (
                <div className="bg-white rounded-md shadow p-4">
                  <h1 className="text-xl font-bold mb-6">Daftar Naskah Keluar</h1>
                  {listNaskah.length === 0 ? (
                    <p className="text-gray-500">Belum ada naskah.</p>
                  ) : (
                    <table className="min-w-full text-sm">
                      <thead className="bg-gray-100">
                        <tr><th className="px-3 py-2">No</th><th className="px-3 py-2">Nomor</th><th className="px-3 py-2">Hal</th><th className="px-3 py-2">Tanggal</th></tr>
                      </thead>
                      <tbody>
                        {listNaskah.map((n,i) => (
                          <tr key={n.id} className="border-t">
                            <td className="px-3 py-2">{i+1}</td>
                            <td className="px-3 py-2">{n.nomorNaskah}</td>
                            <td className="px-3 py-2">{n.hal}</td>
                            <td className="px-3 py-2">{n.tanggal}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  )}
                </div>
              )}

              {activePage === "Tujuan Naskah" && (
                <div className="bg-white rounded-md shadow p-4">
                  <div className="flex items-center justify-between mb-4">
                    <h1 className="text-xl font-bold">Daftar Tujuan Naskah</h1>
                  </div>
                  <form onSubmit={addData(setListTujuan, ["nama","keterangan"])} className="flex gap-2 mb-4">
                    <Input name="nama" placeholder="Nama Tujuan" required />
                    <Input name="keterangan" placeholder="Keterangan" />
                    <Button type="submit">Tambah</Button>
                  </form>
                  <table className="min-w-full text-sm">
                    <thead className="bg-gray-100">
                      <tr><th className="px-3 py-2">No</th><th className="px-3 py-2">Nama</th><th className="px-3 py-2">Keterangan</th><th className="px-3 py-2">Aksi</th></tr>
                    </thead>
                    <tbody>
                      {listTujuan.length===0 && <tr><td colSpan="4" className="text-center py-6 text-gray-500">Belum ada data</td></tr>}
                      {listTujuan.map((t,i)=>(
                        <tr key={t.id} className="border-t">
                          <td className="px-3 py-2">{i+1}</td>
                          <td className="px-3 py-2">{t.nama}</td>
                          <td className="px-3 py-2">{t.keterangan}</td>
                          <td className="px-3 py-2"><Button variant="danger" onClick={()=>removeItem(setListTujuan, t.id)}>Hapus</Button></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}

              {activePage === "Verifikator" && (
                <div className="bg-white rounded-md shadow p-4">
                  <div className="flex items-center justify-between mb-4">
                    <h1 className="text-xl font-bold">Daftar Verifikator</h1>
                  </div>
                  <form onSubmit={addData(setListVerifikator, ["nama","jabatan"])} className="flex gap-2 mb-4">
                    <Input name="nama" placeholder="Nama" required />
                    <Input name="jabatan" placeholder="Jabatan" required />
                    <Button type="submit">Tambah</Button>
                  </form>
                  <table className="min-w-full text-sm">
                    <thead className="bg-gray-100">
                      <tr><th className="px-3 py-2">No</th><th className="px-3 py-2">Nama</th><th className="px-3 py-2">Jabatan</th><th className="px-3 py-2">Aksi</th></tr>
                    </thead>
                    <tbody>
                      {listVerifikator.length===0 && <tr><td colSpan="4" className="text-center py-6 text-gray-500">Belum ada data</td></tr>}
                      {listVerifikator.map((v,i)=>(
                        <tr key={v.id} className="border-t">
                          <td className="px-3 py-2">{i+1}</td>
                          <td className="px-3 py-2">{v.nama}</td>
                          <td className="px-3 py-2">{v.jabatan}</td>
                          <td className="px-3 py-2"><Button variant="danger" onClick={()=>removeItem(setListVerifikator, v.id)}>Hapus</Button></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}

              {activePage === "Penanda Tangan" && (
                <div className="bg-white rounded-md shadow p-4">
                  <div className="flex items-center justify-between mb-4">
                    <h1 className="text-xl font-bold">Daftar Penanda Tangan</h1>
                  </div>
                  <form onSubmit={addData(setListPenandatangan, ["nama","jabatan"])} className="flex gap-2 mb-4">
                    <Input name="nama" placeholder="Nama" required />
                    <Input name="jabatan" placeholder="Jabatan" required />
                    <Button type="submit">Tambah</Button>
                  </form>
                  <table className="min-w-full text-sm">
                    <thead className="bg-gray-100">
                      <tr><th className="px-3 py-2">No</th><th className="px-3 py-2">Nama</th><th className="px-3 py-2">Jabatan</th><th className="px-3 py-2">Aksi</th></tr>
                    </thead>
                    <tbody>
                      {listPenandatangan.length===0 && <tr><td colSpan="4" className="text-center py-6 text-gray-500">Belum ada data</td></tr>}
                      {listPenandatangan.map((p,i)=>(
                        <tr key={p.id} className="border-t">
                          <td className="px-3 py-2">{i+1}</td>
                          <td className="px-3 py-2">{p.nama}</td>
                          <td className="px-3 py-2">{p.jabatan}</td>
                          <td className="px-3 py-2"><Button variant="danger" onClick={()=>removeItem(setListPenandatangan, p.id)}>Hapus</Button></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </main>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
